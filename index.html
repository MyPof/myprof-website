<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyProfEduc - Cours Particuliers Simples et Efficaces</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Styles existants conservés */
        :root {
            --primary-color: #4a6cf7;
            --primary-dark: #3a56d4;
            --secondary-color: #6c757d;
            --accent-color: #ffc107;
            --success-color: #198754;
            --danger-color: #dc3545;
            --text-color: #2d3748;
            --text-light: #718096;
            --light-bg: #f8f9fa;
            --dark-bg: #1e293b;
            --card-shadow: 0 10px 20px rgba(0,0,0,0.05);
            --hover-shadow: 0 15px 30px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
            --border-radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* ... (tous les styles existants conservés) ... */

        /* Nouveaux styles pour le système de contact */
        .contact-teacher-modal {
            max-width: 500px;
        }

        .payment-summary {
            background-color: var(--light-bg);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 1rem 0;
        }

        .payment-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .payment-total {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            border-top: 1px solid #ddd;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .payment-method {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .payment-method:hover {
            border-color: var(--primary-color);
        }

        .payment-method.selected {
            border-color: var(--primary-color);
            background-color: rgba(74, 108, 247, 0.05);
        }

        .payment-method input {
            margin-right: 10px;
        }

        .contact-status {
            text-align: center;
            padding: 2rem;
        }

        .status-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .status-pending {
            color: var(--accent-color);
        }

        .status-accepted {
            color: var(--success-color);
        }

        .status-rejected {
            color: var(--danger-color);
        }
    </style>
</head>
<body>
    <!-- Header et navigation (inchangé) -->
    <header id="header">
        <div class="container header-content">
            <a href="#" class="logo">
                <i class="fas fa-graduation-cap logo-icon"></i> MyProfEduc
            </a>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
            <nav>
                <ul id="navMenu">
                    <li><a href="#home" class="active">Accueil</a></li>
                    <li><a href="#teachers">Trouver un enseignant</a></li>
                    <li><a href="#registration">Inscription</a></li>
                    <li><a href="#about">À propos</a></li>
                    <li><a href="#faq">FAQ</a></li>
                    <li id="loginNavItem"><a href="#" onclick="openLoginModal()">Connexion</a></li>
                    <li id="profileNavItem" style="display: none;"><a href="#profile">Mon profil</a></li>
                    <li id="logoutNavItem" style="display: none;"><a href="#" onclick="logout()">Déconnexion</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Sections existantes (inchangées) -->
    <section id="hero" class="hero">
        <!-- Contenu inchangé -->
    </section>

    <section id="home" class="light">
        <!-- Contenu inchangé -->
    </section>

    <section id="teachers">
        <div class="container">
            <h2 class="section-title">Trouvez votre enseignant</h2>
            <p class="section-subtitle">Parcourez notre sélection d'enseignants qualifiés et expérimentés, prêts à accompagner votre enfant vers la réussite.</p>
            <div class="search-filters">
                <!-- Filtres inchangés -->
            </div>
            <div class="teacher-list" id="teacherList">
                <!-- Les enseignants seront affichés ici -->
            </div>
        </div>
    </section>
    
    <!-- Autres sections (inchangées) -->
    
    <!-- Nouvelle modal pour le contact enseignant -->
    <div id="contactTeacherModal" class="modal">
        <div class="modal-content contact-teacher-modal">
            <button class="modal-close" onclick="closeContactTeacherModal()">&times;</button>
            <h3>Contacter l'enseignant</h3>
            <div id="contactTeacherStep1">
                <p>Vous êtes sur le point de contacter <span id="contactTeacherName"></span> pour des cours de <span id="contactTeacherSubject"></span>.</p>
                <p>Un paiement de 5€ est requis pour débloquer les coordonnées de l'enseignant. Ce montant ne sera prélevé que si l'enseignant accepte votre demande.</p>
                
                <div class="payment-summary">
                    <div class="payment-info">
                        <span>Frais de mise en relation:</span>
                        <span>5,00 €</span>
                    </div>
                    <div class="payment-total">
                        <span>Total:</span>
                        <span>5,00 €</span>
                    </div>
                </div>
                
                <div class="payment-methods">
                    <label class="payment-method">
                        <input type="radio" name="paymentMethod" value="card" checked>
                        <i class="fas fa-credit-card"></i> Carte bancaire
                    </label>
                    <label class="payment-method">
                        <input type="radio" name="paymentMethod" value="paypal">
                        <i class="fab fa-paypal"></i> PayPal
                    </label>
                </div>
                
                <button class="btn btn-primary" onclick="proceedToContactStep2()">
                    <i class="fas fa-lock"></i> Payer et contacter
                </button>
            </div>
            
            <div id="contactTeacherStep2" style="display: none;">
                <div class="contact-status">
                    <div class="status-icon status-pending">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3>Demande envoyée</h3>
                    <p>Votre demande de contact a été envoyée à <span id="contactTeacherName2"></span>.</p>
                    <p>Un prélèvement de 5€ a été réservé sur votre compte. Il ne sera définitivement prélevé que si l'enseignant accepte votre demande dans les 7 jours.</p>
                    <p>Vous serez notifié par email de la réponse de l'enseignant.</p>
                </div>
                <button class="btn btn-primary" onclick="closeContactTeacherModal()">
                    <i class="fas fa-check"></i> Compris
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmation de paiement (pour simulation) -->
    <div id="paymentSimulationModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closePaymentSimulationModal()">&times;</button>
            <h3>Simulation de paiement</h3>
            <p>Pour la démonstration, le paiement est simulé. En production, cette étape connecterait à un vrai système de paiement.</p>
            <div class="form-group">
                <label for="cardNumber">Numéro de carte</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" value="4242 4242 4242 4242">
            </div>
            <div class="form-group">
                <label for="cardExpiry">Date d'expiration</label>
                <input type="text" id="cardExpiry" placeholder="MM/AA" value="12/25">
            </div>
            <div class="form-group">
                <label for="cardCvc">CVC</label>
                <input type="text" id="cardCvc" placeholder="123" value="123">
            </div>
            <button class="btn btn-primary" onclick="simulatePaymentSuccess()">
                <i class="fas fa-check"></i> Simuler le paiement
            </button>
        </div>
    </div>

    <footer>
        <!-- Pied de page inchangé -->
    </footer>

    <script>
        // Données des enseignants (inchangées)
        const teachers = [
            // ... (liste des enseignants inchangée)
        ];

        // Liste des villes françaises (inchangée)
        const frenchCities = [
            "Paris", "Marseille", "Lyon", "Toulouse", "Nice", "Nantes", "Strasbourg", "Montpellier", "Bordeaux", "Lille",
            "Rennes", "Reims", "Le Havre", "Saint-Étienne", "Toulon", "Grenoble", "Dijon", "Angers", "Nîmes", "Villeurbanne"
        ];

        // Variables pour gérer le contact enseignant
        let currentTeacherId = null;
        let contactRequests = JSON.parse(localStorage.getItem('contactRequests')) || [];

        // Fonction pour afficher les enseignants (inchangée)
        function renderTeachers(teachersToRender) {
            // ... (code inchangé)
        }

        // Fonction pour filtrer les enseignants (inchangée)
        function filterTeachers() {
            // ... (code inchangé)
        }

        // Fonction pour contacter un enseignant (MODIFIÉE)
        function contactTeacher(teacherId) {
            // Vérifier si l'utilisateur est connecté
            if (document.getElementById('loginNavItem').style.display === 'list-item') {
                openLoginModal();
                return;
            }

            currentTeacherId = teacherId;
            const teacher = teachers.find(t => t.id === teacherId);
            
            if (teacher) {
                document.getElementById('contactTeacherName').textContent = teacher.name;
                document.getElementById('contactTeacherName2').textContent = teacher.name;
                document.getElementById('contactTeacherSubject').textContent = teacher.subject;
                
                // Vérifier si une demande existe déjà
                const existingRequest = contactRequests.find(req => 
                    req.teacherId === teacherId && req.parentEmail === 'utilisateur@example.com'
                );
                
                if (existingRequest) {
                    showContactStatus(existingRequest.status);
                } else {
                    document.getElementById('contactTeacherStep1').style.display = 'block';
                    document.getElementById('contactTeacherStep2').style.display = 'none';
                    openContactTeacherModal();
                }
            }
        }

        // Fonction pour afficher le statut de contact
        function showContactStatus(status) {
            document.getElementById('contactTeacherStep1').style.display = 'none';
            document.getElementById('contactTeacherStep2').style.display = 'block';
            
            const statusIcon = document.querySelector('.status-icon');
            statusIcon.className = 'status-icon ';
            
            if (status === 'accepted') {
                statusIcon.classList.add('status-accepted');
                statusIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                document.querySelector('#contactTeacherStep2 h3').textContent = 'Demande acceptée';
                document.querySelector('#contactTeacherStep2 p').innerHTML = 
                    'Votre demande a été acceptée par l\'enseignant. Les 5€ ont été définitivement prélevés et vous pouvez maintenant contacter l\'enseignant aux coordonnées suivantes: <strong>email@exemple.com - 01 23 45 67 89</strong>';
            } else if (status === 'rejected') {
                statusIcon.classList.add('status-rejected');
                statusIcon.innerHTML = '<i class="fas fa-times-circle"></i>';
                document.querySelector('#contactTeacherStep2 h3').textContent = 'Demande refusée';
                document.querySelector('#contactTeacherStep2 p').textContent = 
                    'Votre demande a été refusée par l\'enseignant. Le prélèvement de 5€ a été annulé.';
            } else {
                statusIcon.classList.add('status-pending');
                statusIcon.innerHTML = '<i class="fas fa-clock"></i>';
                document.querySelector('#contactTeacherStep2 h3').textContent = 'Demande en attente';
                document.querySelector('#contactTeacherStep2 p').innerHTML = 
                    'Votre demande de contact est en attente de réponse de l\'enseignant. Un prélèvement de 5€ a été réservé sur votre compte. Il ne sera définitivement prélevé que si l\'enseignant accepte votre demande dans les 7 jours.';
            }
            
            openContactTeacherModal();
        }

        // Fonction pour passer à l'étape 2 du contact
        function proceedToContactStep2() {
            // Ouvrir la modal de simulation de paiement
            closeContactTeacherModal();
            openPaymentSimulationModal();
        }

        // Fonction pour simuler un paiement réussi
        function simulatePaymentSuccess() {
            // Fermer la modal de paiement
            closePaymentSimulationModal();
            
            // Enregistrer la demande de contact
            const newRequest = {
                teacherId: currentTeacherId,
                parentEmail: 'utilisateur@example.com',
                date: new Date().toISOString(),
                status: 'pending',
                amount: 5
            };
            
            contactRequests.push(newRequest);
            localStorage.setItem('contactRequests', JSON.stringify(contactRequests));
            
            // Afficher le statut de la demande
            showContactStatus('pending');
        }

        // Fonctions pour ouvrir/fermer les modals
        function openContactTeacherModal() {
            document.getElementById('contactTeacherModal').style.display = 'flex';
        }

        function closeContactTeacherModal() {
            document.getElementById('contactTeacherModal').style.display = 'none';
        }

        function openPaymentSimulationModal() {
            document.getElementById('paymentSimulationModal').style.display = 'flex';
        }

        function closePaymentSimulationModal() {
            document.getElementById('paymentSimulationModal').style.display = 'none';
        }

        // Fonction pour simuler l'acceptation d'une demande (pour démonstration)
        function simulateAcceptRequest(teacherId) {
            const requestIndex = contactRequests.findIndex(req => 
                req.teacherId === teacherId && req.parentEmail === 'utilisateur@example.com'
            );
            
            if (requestIndex !== -1) {
                contactRequests[requestIndex].status = 'accepted';
                localStorage.setItem('contactRequests', JSON.stringify(contactRequests));
                
                // Recharger la page pour voir le statut mis à jour
                location.reload();
            }
        }

        // Fonction pour simuler le rejet d'une demande (pour démonstration)
        function simulateRejectRequest(teacherId) {
            const requestIndex = contactRequests.findIndex(req => 
                req.teacherId === teacherId && req.parentEmail === 'utilisateur@example.com'
            );
            
            if (requestIndex !== -1) {
                contactRequests[requestIndex].status = 'rejected';
                localStorage.setItem('contactRequests', JSON.stringify(contactRequests));
                
                // Recharger la page pour voir le statut mis à jour
                location.reload();
            }
        }

        // Fonctions existantes (inchangées)
        function populateCityDropdowns() {
            // ... (code inchangé)
        }

        function showTab(tabId) {
            // ... (code inchangé)
        }

        function addSubject() {
            // ... (code inchangé)
        }

        function addDegree() {
            // ... (code inchangé)
        }

        function previewTeacherPhoto(event) {
            // ... (code inchangé)
        }

        function validatePassword(password, validationPrefix = '') {
            // ... (code inchangé)
        }

        function registerTeacher() {
            // ... (code inchangé)
        }

        function registerParent() {
            // ... (code inchangé)
        }

        function openLoginModal() {
            // ... (code inchangé)
        }

        function closeLoginModal() {
            // ... (code inchangé)
        }

        function login() {
            // ... (code inchangé)
        }

        function logout() {
            // ... (code inchangé)
        }

        function showProfile() {
            // ... (code inchangé)
        }

        function showProfileTab(tabId) {
            // ... (code inchangé)
        }

        function openAddChildModal() {
            // ... (code inchangé)
        }

        function closeAddChildModal() {
            // ... (code inchangé)
        }

        function addChild() {
            // ... (code inchangé)
        }

        function toggleFaq(element) {
            // ... (code inchangé)
        }

        function sendContactMessage() {
            // ... (code inchangé)
        }

        function resendVerification() {
            // ... (code inchangé)
        }

        function animateValue(id, start, end, duration) {
            // ... (code inchangé)
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            // Afficher les enseignants
            renderTeachers(teachers);
            
            // Remplir les listes déroulantes des villes
            populateCityDropdowns();
            
            // Configurer la validation des mots de passe
            document.getElementById('teacherPassword').addEventListener('input', function() {
                validatePassword(this.value);
            });
            
            document.getElementById('parentPassword').addEventListener('input', function() {
                validatePassword(this.value, 'parent');
            });
            
            // Animation des statistiques
            animateValue('teacherCount', 0, 20025, 2000);
            animateValue('parentCount', 0, 45120, 2000);
            animateValue('studentCount', 0, 78356, 2000);
            
            // Vérifier s'il y a des demandes de contact en attente
            const pendingRequests = contactRequests.filter(req => 
                req.parentEmail === 'utilisateur@example.com' && req.status === 'pending'
            );
            
            if (pendingRequests.length > 0) {
                // Afficher une notification
                console.log('Vous avez des demandes de contact en attente');
            }
        });
    </script>
</body>
</html>
